game.Lighting.MainColorCorrection.TintColor = Color3.fromRGB(0, 0, 0)
wait(2)
game.Lighting.MainColorCorrection.TintColor = Color3.fromRGB(255, 255, 255)
game:GetService("Lighting").MainColorCorrection.Contrast = 10

function GitAud(soundgit,filename)
    SoundName=tostring(SoundName)
    local url=soundgit
    local FileName = filename
    writefile(FileName..".mp3", game:HttpGet(url))
    return (getcustomasset or getsynasset)(FileName..".mp3")
end

function CustomGitSound(soundlink, vol, filename)
    local sound = Instance.new("Sound")
    sound.SoundId = GitAud(soundlink, filename)
    sound.Parent = workspace
    sound.Volume = 2
    sound.PlaybackSpeed = 1
    sound.Name = "DREAMCORE"
    sound.Looped = false
   sound:Play()
end

CustomGitSound("https://github.com/Guestly-V2-2/Music-Sound/raw/refs/heads/main/YTDowncom_YouTube_Six-Forty-Seven_Media_NkzzjHaXfaw_001_1080p.mp3?raw=true", 1, " dreammusic")

local player = game.Players.LocalPlayer

-- ===== TEXT LIST =====
local texts = {
	"Don't be afraid",
	"You are not real",
	"Do you think you are safe",
	"Never give up",
	"It is not real",
	"Get out of my head",
  "RUN RUN RUN!",
  "HIDE!"
}

-- ===== KÝ HIỆU WHITELIST =====
local symbols = { "#", "@", "%", "*", "_", "(", ")", "?", "¿" }

-- ===== GUI =====
local gui = Instance.new("ScreenGui")
gui.Name = "RedTextHorror"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local label = Instance.new("TextLabel")
label.Parent = gui
label.BackgroundTransparency = 1
label.TextColor3 = Color3.fromRGB(255, 0, 0)
label.TextStrokeTransparency = 0
label.TextStrokeColor3 = Color3.new(0,0,0)
label.TextScaled = true
label.Size = UDim2.fromScale(0.33, 0.33)
label.AnchorPoint = Vector2.new(0.5, 0.5)
label.TextWrapped = true
label.Font = Enum.Font.SourceSansBold

-- ===== RANDOM VỊ TRÍ =====
local function randomPosition()
	local x = math.random(20, 80) / 100
	local y = math.random(20, 80) / 100
	label.Position = UDim2.fromScale(x, y)
end

-- ===== LOOP ĐỔI TEXT + VỊ TRÍ (2s) =====
task.spawn(function()
	while true do
		label.Text = texts[math.random(1, #texts)]
		randomPosition()
		task.wait(2)
	end
end)

-- ===== GLITCH NHIỀU KÝ TỰ + SYMBOL =====
task.spawn(function()
	while true do
		local original = label.Text
		local length = #original

		if length > 0 then
			local chars = {}
			for i = 1, length do
				chars[i] = string.sub(original, i, i)
			end

			local glitchCount = math.random(2, 6) -- số ký tự bị ảnh hưởng
			local used = {}

			for i = 1, glitchCount do
				local index
				repeat
					index = math.random(1, length)
				until not used[index]

				used[index] = true

				-- 50% viết HOA, 50% đổi thành ký hiệu
				if math.random() < 0.5 then
					chars[index] = string.upper(chars[index])
				else
					chars[index] = symbols[math.random(1, #symbols)]
				end
			end

			label.Text = table.concat(chars)
			task.wait(0.1)

			-- trả lại text gốc
			label.Text = original
		end

		task.wait(0.05)
	end
end)

local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "overlaygui"
screenGui.Parent = playerGui
screenGui.IgnoreGuiInset = true

local red = Instance.new("ImageLabel")
red.Name = "overlay"
red.Size = UDim2.new(1, 0, 1, 0)
red.BackgroundTransparency = 1 -- Make the background fully transparent
red.Image = "rbxassetid://89921841313942" -- Set the image using a random Image ID
red.ImageTransparency = 0
red.ZIndex = 2
red.Parent = screenGui

local red2 = Instance.new("ImageLabel")
red2.Name = "overlay2"
red2.Size = UDim2.new(1, 0, 1, 0)
red2.BackgroundTransparency = 1 -- Make the background fully transparent
red2.ImageTransparency = 0.8
red2.Parent = screenGui
red2.ZIndex = 1

local img = red2

local images = {
	"rbxassetid://76637426417491",
	"rbxassetid://94547864377343"
}

local i = 1

task.spawn(function()
	while true do
		img.Image = images[i]
		i = i % #images + 1
		task.wait(0.5)
	end
end)

-- COLLISION (đoạn bị ngắt)
local Character = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")
local Camera = workspace.CurrentCamera
local Collision

Collision = Character:FindFirstChild("CollisionPart")
    if not Collision then
        for _, part in pairs(Character:GetChildren()) do
            if part:IsA("BasePart") and part.Name:lower():find("collision") then
                Collision = part
                break
            end
        end
    end
    
    if not Collision then
        Collision = RootPart
    end
    
    local CollisionClone = Collision:Clone()
    CollisionClone.CanCollide = false
    CollisionClone.Massless = true
    CollisionClone.CanQuery = false
    CollisionClone.Name = "CollisionClone"
    
    if CollisionClone:FindFirstChild("CollisionCrouch") then
        CollisionClone.CollisionCrouch:Destroy()
    end
    
    CollisionClone.Parent = Character
    
    task.spawn(function()
        while Character.Parent do
            if RootPart.Anchored then
                CollisionClone.Massless = true
                repeat task.wait() until not RootPart.Anchored
                task.wait(0.15)
            else
                CollisionClone.Massless = not CollisionClone.Massless
            end
            task.wait(0.24)
        end
    end)

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local DESIRED_SPEED = 10

local function applyToCharacter(char)
	local hum = char:WaitForChild("Humanoid")

	-- set ngay lần đầu
	hum.WalkSpeed = DESIRED_SPEED

	-- theo dõi mọi thay đổi
	hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
		if hum.WalkSpeed ~= DESIRED_SPEED then
			hum.WalkSpeed = DESIRED_SPEED
		end
	end)

	-- backup loop phòng trường hợp bị force đổi liên tục
	local wsLoopRunning = true
task.spawn(function()
	while wsLoopRunning and hum.Parent do
		if hum.WalkSpeed ~= DESIRED_SPEED then
			hum.WalkSpeed = DESIRED_SPEED
		end
		task.wait(0.2) -- giảm 10–20x tải CPU
	end
end)

-- khi effect kết thúc thì thêm:
-- wsLoopRunning = false
end

-- khi spawn
if player.Character then
	applyToCharacter(player.Character)
end

-- khi respawn
player.CharacterAdded:Connect(applyToCharacter)

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

-------------------------------------------------
-- PLAYER
-------------------------------------------------
local LocalPlayer = Players.LocalPlayer
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local Lighting = game:GetService("Lighting")

-------------------------------------------------
-- CONFIG
-------------------------------------------------
local PART_SPEED =  10        -- tá»‘c Ä‘á»™ di chuyá»ƒn
local SPAWN_DISTANCE = 140     -- spawn phÃ­a sau player

-------------------------------------------------
-- STATE
-------------------------------------------------
local isPlayerHiding = false
local triggered = false
local CHASE_DURATION = 120 -- 1 phút
local chaseStartTime = tick()
local chaseEnded = false

local function BlackoutEffect()
	-- lưu lighting cũ
	local oldBrightness = Lighting.Brightness
	local oldClockTime = Lighting.ClockTime
	local oldFogEnd = Lighting.FogEnd

	Lighting.Brightness = 0
	Lighting.ClockTime = 0
	Lighting.FogEnd = 5

	task.wait(2) -- thời gian bị đen màn

	-- trả lại bình thường
	Lighting.Brightness = oldBrightness
	Lighting.ClockTime = oldClockTime
	Lighting.FogEnd = oldFogEnd
end

-------------------------------------------------
-- PART (SPAWN SAU LÆ¯NG PLAYER)
-------------------------------------------------
local offsetX = math.random(-10,10)
local offsetY = math.random(-3,3)

local part = Instance.new("Part")
part.Size = Vector3.new(5,5,5)
part.Name = "EyeFallen"
part.Anchored = true
part.Transparency = 1
part.CanCollide = false
part.Massless = true
part.CastShadow = false
part.CFrame = hrp.CFrame * CFrame.new(offsetX, offsetY, SPAWN_DISTANCE)
part.Parent = workspace

-------------------------------------------------
-- BILLBOARD
-------------------------------------------------
local billboard = Instance.new("BillboardGui")
billboard.Size = UDim2.new(15,0,15,0)
billboard.AlwaysOnTop = true
billboard.StudsOffset = Vector3.new(0,0.3,0)
billboard.Adornee = part
billboard.Parent = part

local imageLabel = Instance.new("ImageLabel")
imageLabel.Size = UDim2.new(1,0,1,0)
imageLabel.BackgroundTransparency = 1
imageLabel.Parent = billboard

-------------------------------------------------
-- IMAGES
-------------------------------------------------
local IMAGE_ID_1 = "rbxassetid://109195590059206"
local IMAGE_ID_2 = "rbxassetid://100354158951933"
local IMAGE_IDLE = "rbxassetid://70679133939195" -- máº·t khi Ä‘á»©ng im
imageLabel.Image = IMAGE_ID_1

-------------------------------------------------
-- BILLBOARD IMAGE CONTROLLER
-------------------------------------------------
task.spawn(function()
	local toggle = false

	while part.Parent do
		if isPaused then
			-- Ä‘á»©ng im â†’ 1 máº·t duy nháº¥t
			imageLabel.Image = IMAGE_IDLE
			task.wait(0.1)
		else
			-- di chuyá»ƒn â†’ Ä‘á»•i máº·t liÃªn tá»¥c
			toggle = not toggle
			imageLabel.Image = toggle and IMAGE_ID_1 or IMAGE_ID_2
			task.wait(1)
		end
	end
end)

-------------------------------------------------
-- BILLBOARD SHAKE (FIX)
-------------------------------------------------
task.spawn(function()
	local t = 0
	while imageLabel.Parent do
		t += 0.15
		imageLabel.Position = UDim2.new(
			0, math.sin(t) * 3,
			0, math.cos(t * 1.3) * 3
		)
		imageLabel.Rotation = math.sin(t * 0.8) * 2
		task.wait(119)
	end
end)

-------------------------------------------------
-- HIDE DETECTOR (USING HIDING ATTRIBUTE)
-------------------------------------------------
task.spawn(function()
	while character.Parent do
		-- Æ°u tiÃªn láº¥y tá»« character
		local hiding = character:GetAttribute("Hiding")

		-- fallback: cÃ³ vÃ i báº£n gáº¯n attribute á»Ÿ HRP
		if hiding == nil then
			hiding = hrp:GetAttribute("Hiding")
		end

		isPlayerHiding = (hiding == true)
		task.wait(0.1)
	end
end)

-------------------------------------------------
-- DIRECT GHOST CHASE (XUYÊN TƯỜNG)
-------------------------------------------------
task.spawn(function()
	while part.Parent do
		
		-- ⏳ HẾT 1 PHÚT → KẾT THÚC
		if not chaseEnded and tick() - chaseStartTime >= CHASE_DURATION then
			chaseEnded = true
			task.spawn(BlackoutEffect)
			part:Destroy()
     local player = game.Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui"):FindFirstChild("RedTextHorror")

if gui then
	gui:Destroy()
end
     game.Lighting.MainColorCorrection.TintColor = Color3.fromRGB(0, 0, 0)
     local music = game.Workspace.DREAMCORE
if music then
game.Workspace.DREAMCORE:Destroy()
end
if not music then
print("no music found")

local o1 = game.Players.LocalPlayer.PlayerGui.overlaygui
if o1 then
game.Players.LocalPlayer.PlayerGui.overlaygui:Destroy()
end
if not o1 then
print("no overlay1 found")
end

wait(2)
game.Lighting.MainColorCorrection.TintColor = Color3.fromRGB(255, 255, 255)
game:GetService("Lighting").MainColorCorrection.Contrast = 0.05
end

-- One-time execute guard
if getgenv()._ANGEL_ALREADY_EXECUTED then
    warn("[SCRIPT] Script đã được chạy trước đó, từ chối execute!")
    return
end

getgenv()._ANGEL_ALREADY_EXECUTED = true

-- ======================
-- SCRIPT CHÍNH BẮT ĐẦU Ở ĐÂY
-- ======================

print("[SCRIPT] Execute lần đầu thành công!")

local achievementGiver = loadstring(game:HttpGet("https://raw.githubusercontent.com/Voor-Pr00/Achivements/refs/heads/main/Voorpr0"))()

---====== Display achievement ======---
achievementGiver({
    Title = "THE NIGHTMARE MEMORIES",
    Desc = "RUN RUN RUN.",
    Reason = "Survived The Fallen Angel",
    Image = "rbxassetid://102714901241873"
})

			break
		end
		
		isPaused = isPlayerHiding

		if not isPaused then
			local targetPos = hrp.Position
			local direction = (targetPos - part.Position)
			local distance = direction.Magnitude
			
			if distance > 1 then
				local moveVector = direction.Unit * PART_SPEED * 0.03
				part.CFrame = part.CFrame + moveVector
			end
		end
		
		task.wait(0.03) -- mượt
	end
end)

-------------------------------------------------
-- TOUCH HOOK + DESTROY
-------------------------------------------------
part.Touched:Connect(function(hit)
if chaseEnded then return end
	if triggered then return end
	local hum = hit.Parent and hit.Parent:FindFirstChildOfClass("Humanoid")
	if hum and hit.Parent == character then
		triggered = true

game.Workspace.EyeFallen:Destroy()
local player = game.Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui"):FindFirstChild("RedTextHorror")

if gui then
	gui:Destroy()
end

local music = game.Workspace.DREAMCORE
if music then
local TweenService = game:GetService("TweenService")
local TW = TweenService:Create(game.Workspace.DREAMCORE, TweenInfo.new(2),{PlaybackSpeed = 0})
TW:Play()
wait(2.5)
game.Workspace.DREAMCORE:Destroy()
end
if not music then
print("no music found")
end

local o1 = game.Players.LocalPlayer.PlayerGui.overlaygui
if o1 then
game.Players.LocalPlayer.PlayerGui.overlaygui:Destroy()
end
if not o1 then
print("no overlay1 found")
end

game.Lighting.MainColorCorrection.TintColor = Color3.fromRGB(0, 0, 0)
task.wait(2)

--[[ 
    STATIC PREVIEW (SHAKE + DIZZY) → HARD JUMPSCARE
    FULL ORIGINAL FEATURES PRESERVED
--]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- ================= CONFIG =================
local PREVIEW_IMAGE   = "rbxassetid://109195590059206"
local JUMPSCARE_IMAGE = "rbxassetid://109195590059206"

local PREVIEW_SOUND_ID = "rbxassetid://0"
local SCREAM_SOUND_ID  = "rbxassetid://130990524400761"

local PREVIEW_TIME = 3
local PREVIEW_SHAKE = 0.008
local DIZZY_INTENSITY = 0.012

local JUMP_IMAGE_SHAKE = 0.05
local SHAKE_TIME = 6

local CAM_SHAKE_INTENSITY = 1.6
local FOV_JUMP = 35
-- =========================================

-- ================= SAVE STATE =================
local oldFOV = camera.FieldOfView

local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local oldWS = humanoid.WalkSpeed
local oldJP = humanoid.JumpPower

humanoid.WalkSpeed = 0
humanoid.JumpPower = 0

-- ================= GUI =================
local gui = Instance.new("ScreenGui")
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = player.PlayerGui

local image = Instance.new("ImageLabel")
image.AnchorPoint = Vector2.new(0.5, 0.5)
image.Position = UDim2.new(0.5, 0, 0.5, 0)
image.Size = UDim2.new(0.45, 0, 0.45, 0)
image.BackgroundTransparency = 1
image.Image = PREVIEW_IMAGE
image.Parent = gui

Instance.new("UIAspectRatioConstraint", image)

-- ================= PREVIEW SOUND =================
local previewSound = Instance.new("Sound")
previewSound.SoundId = PREVIEW_SOUND_ID
previewSound.Volume = 0
previewSound.Looped = true
previewSound.Parent = workspace
previewSound:Play()

TweenService:Create(
    previewSound,
    TweenInfo.new(PREVIEW_TIME),
    { Volume = 3 }
):Play()

-- ================= PREVIEW SHAKE + DIZZY =================
local previewing = true
local basePos = image.Position
local t = 0

task.spawn(function()
    local start = tick()
    while previewing and tick() - start < PREVIEW_TIME do
        t += 0.15
        image.Position = basePos + UDim2.new(
            math.sin(t) * DIZZY_INTENSITY + (math.random() - 0.5) * PREVIEW_SHAKE, 0,
            math.cos(t) * DIZZY_INTENSITY + (math.random() - 0.5) * PREVIEW_SHAKE, 0
        )
        RunService.RenderStepped:Wait()
    end
    image.Position = basePos
end)

task.wait(PREVIEW_TIME)
previewing = false
previewSound:Destroy()

-- ================= SCREAM =================
local scream = Instance.new("Sound")
scream.SoundId = SCREAM_SOUND_ID
scream.Volume = 10
scream.Parent = workspace
scream:Play()

humanoid:TakeDamage(100)

-- ================= DEATH HINT =================
firesignal(
    game.ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent,
    {
        "We are so happy...",
        "All the joys, all the angels are around us!",
        "We can not miss the chance right?"
    },
    "Blue"
)

game.ReplicatedStorage.GameStats["Player_" .. player.Name]
    .Total.DeathCause.Value = "The Fallen Angel"

-- ================= HARD JUMPSCARE =================
image.Image = JUMPSCARE_IMAGE

TweenService:Create(
    image,
    TweenInfo.new(0.08, Enum.EasingStyle.Back),
    { Size = UDim2.new(1.2, 0, 1.2, 0) }
):Play()

TweenService:Create(
    camera,
    TweenInfo.new(0.15),
    { FieldOfView = FOV_JUMP }
):Play()

-- ================= CAMERA SHAKE =================
local camCF = camera.CFrame
local camShaking = true

task.spawn(function()
    local start = tick()
    while camShaking and tick() - start < SHAKE_TIME do
        camera.CFrame = camCF * CFrame.new(
            math.random(-100, 100) / 100 * CAM_SHAKE_INTENSITY,
            math.random(-100, 100) / 100 * CAM_SHAKE_INTENSITY,
            0
        )
        RunService.RenderStepped:Wait()
    end
    camera.CFrame = camCF
end)

-- ================= IMAGE SHAKE (KEEP DURING FADE) =================
local imgShaking = true
local imgBasePos = image.Position

task.spawn(function()
    local start = tick()
    while imgShaking and tick() - start < SHAKE_TIME do
        image.Position = imgBasePos + UDim2.new(
            (math.random() - 0.5) * JUMP_IMAGE_SHAKE, 0,
            (math.random() - 0.5) * JUMP_IMAGE_SHAKE, 0
        )
        RunService.RenderStepped:Wait()
    end
    image.Position = imgBasePos
end)

-- ================= FADE OUT =================
task.delay(3, function()
    TweenService:Create(
        image,
        TweenInfo.new(3),
        { ImageTransparency = 1 }
    ):Play()

    camShaking = false
    imgShaking = false

    humanoid.WalkSpeed = oldWS
    humanoid.JumpPower = oldJP

    TweenService:Create(
        camera,
        TweenInfo.new(0.4),
        { FieldOfView = oldFOV }
    ):Play()

    task.delay(0.5, function()
        gui:Destroy()
        scream:Destroy()
-- One-time execute guard
if getgenv()._ANGEL_ALREADY_EXECUTED then
    warn("[SCRIPT] Script đã được chạy trước đó, từ chối execute!")
    return
end

getgenv()._ANGEL_ALREADY_EXECUTED = true

-- ======================
-- SCRIPT CHÍNH BẮT ĐẦU Ở ĐÂY
-- ======================

print("[SCRIPT] Execute lần đầu thành công!")

local achievementGiver = loadstring(game:HttpGet("https://raw.githubusercontent.com/Voor-Pr00/Achivements/refs/heads/main/Voorpr0"))()

---====== Display achievement ======---
achievementGiver({
    Title = "THE NIGHTMARE MEMORIES",
    Desc = "RUN RUN RUN.",
    Reason = "Died to The Fallen Angel",
    Image = "rbxassetid://102714901241873"
})
    end)
end)
end
end)
