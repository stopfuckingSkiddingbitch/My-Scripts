--// ===== CONFIG =====
local MODEL_ID = "rbxassetid://104113697879933"
local MOVE_SPEED = 100
local HITBOX_RANGE = 0.01
local WAIT_AFTER_KILL = 1
local WAIT_AT_END = 2
local START_DELAY = 5

--// ===== SERVICES =====
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local roomsFolder = workspace:WaitForChild("CurrentRooms")

--// SORT ROOMS
local function getSortedRooms()
    local rooms = {}
    for _, room in pairs(roomsFolder:GetChildren()) do
        local num = tonumber(room.Name)
        if num then
            table.insert(rooms, {num = num, room = room})
        end
    end
    table.sort(rooms, function(a,b) return a.num < b.num end)
    return rooms
end

_G.DeathHook = function(player)
    local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

--// SERVICES
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

--// REMOVE OLD GUI
pcall(function()
	if CoreGui:FindFirstChild("JumpscareGui") then
		CoreGui.JumpscareGui:Destroy()
	end
end)

--// LOAD SOUND
local function loadSound(data)
	local sound = Instance.new("Sound")
	local id = tostring(data[1])
	local props = data[2] or {}

	for k, v in pairs(props) do
		if k ~= "SoundId" and k ~= "Parent" then
			sound[k] = v
		end
	end

	if id:find("rbxasset://") then
		sound.SoundId = id
	else
		sound.SoundId = "rbxassetid://" .. id:gsub("%D", "")
	end

	sound.Parent = workspace
	return sound
end

--// CONFIG (Báº N CÃ“ THá»‚ CHá»ˆNH)
local config = {
	Image1 = "rbxassetid://84212097949690",
	Image2 = "rbxassetid://84212097949690",

	Shake = true,

	Sound1 = {0, {Volume = 10}},
	Sound2 = {119580828045347, {Volume = 10}},

	Flashing = {
		true,
		Color3.fromRGB(255, 255, 255)
	},

	Tease = {
		true,
		Min = 1,
		Max = 3
	}
}

--// CREATE GUI
local gui = Instance.new("ScreenGui")
gui.Name = "JumpscareGui"
gui.IgnoreGuiInset = true
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = CoreGui

local bg = Instance.new("Frame")
bg.Size = UDim2.new(1, 0, 1, 0)
bg.BackgroundColor3 = Color3.new(0, 0, 0)
bg.BorderSizePixel = 0
bg.ZIndex = 999
bg.Parent = gui

local face = Instance.new("ImageLabel")
face.AnchorPoint = Vector2.new(0.5, 0.5)
face.Position = UDim2.new(0.5, 0, 0.5, 0)
face.Size = UDim2.new(0, 150, 0, 150)
face.BackgroundTransparency = 1
face.Image = config.Image1
face.ResampleMode = Enum.ResamplerMode.Pixelated
face.Parent = bg

--// SIZES
local screenY = gui.AbsoluteSize.Y
local minSize = screenY / 5
local maxSize = screenY / 2.5

--// TEASE
local sound1, sound2
if config.Sound1 then sound1 = loadSound(config.Sound1) end
if config.Sound2 then sound2 = loadSound(config.Sound2) end

if config.Tease and config.Tease[1] then
	local loops = math.random(config.Tease.Min, config.Tease.Max)
	if sound1 then sound1:Play() end

	for _ = 1, loops do
		task.wait(math.random(10, 20) / 100)
		local grow = (maxSize - minSize) / loops
		face.Size = face.Size + UDim2.new(0, grow, 0, grow)
	end
end

--// FLASHING
if config.Flashing and config.Flashing[1] then
	task.spawn(function()
		while gui.Parent do
			bg.BackgroundColor3 = config.Flashing[2]
			task.wait(math.random(25, 100) / 1000)
			bg.BackgroundColor3 = Color3.new(0, 0, 0)
			task.wait(math.random(25, 100) / 1000)
		end
	end)
end

--// SHAKE
if config.Shake then
	task.spawn(function()
		local basePos = face.Position
		while gui.Parent do
			face.Position = basePos + UDim2.new(0, math.random(-10, 10), 0, math.random(-10, 10))
			face.Rotation = math.random(-5, 5)
			task.wait()
		end
	end)
end

--// FINAL JUMPSCARE
face.Image = config.Image2
face.Size = UDim2.new(0, maxSize, 0, maxSize)

if sound2 then sound2:Play() end

TweenService:Create(face, TweenInfo.new(0.75), {
	Size = UDim2.new(0, screenY * 3, 0, screenY * 3),
	ImageTransparency = 0.5
}):Play()

humanoid:TakeDamage(100)
task.wait(0.75)

--// CLEANUP
gui:Destroy()
if sound1 then sound1:Destroy() end
if sound2 then sound2:Destroy() end

-- ================= DEATH HINT =================
firesignal(
    game.ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent,
    {
        "You died to who called A-200..",
        "When he appears, there will be breaking noise",
        "Hide as soon as possible for your life.."
    },
    "Blue"
)

game.ReplicatedStorage.GameStats["Player_" .. player.Name]
    .Total.DeathCause.Value = "A-200"

-- One-time execute guard
if getgenv()._200_ALREADY_EXECUTED then
    warn("[SCRIPT] Script Ä‘Ã£ Ä‘Æ°á»£c cháº¡y trÆ°á»›c Ä‘Ã³, tá»« chá»‘i execute!")
    return
end

getgenv()._200_ALREADY_EXECUTED = true

-- ======================
-- SCRIPT CHÃNH Báº®T Äáº¦U á»ž ÄÃ‚Y
-- ======================

print("[SCRIPT] Execute láº§n Ä‘áº§u thÃ nh cÃ´ng!")

local achievementGiver = loadstring(game:HttpGet("https://raw.githubusercontent.com/Voor-Pr00/Achivements/refs/heads/main/Voorpr0"))()

---====== Display achievement ======---
achievementGiver({
    Title = "The Scribbles",
    Desc = "You can not just stand there.",
    Reason = "Encountered A-200",
    Image = "rbxassetid://84212097949690"
})
end

-- MOVE FUNCTION
local function tweenTo(part, pos)
    local dist = (part.Position - pos).Magnitude
    local time = dist / MOVE_SPEED
    local tween = TweenService:Create(part, TweenInfo.new(time, Enum.EasingStyle.Linear), {
        CFrame = CFrame.new(pos)
    })
    tween:Play()
    tween.Completed:Wait()
end

-- GET PATH NODES FROM ROOM
local function getRoomPath(room)
    local nodesFolder = room:FindFirstChild("PathfindNodes")
    if not nodesFolder then
        return nil
    end

    local nodes = nodesFolder:GetChildren()
    if #nodes == 0 then
        return nil
    end

    -- sort theo tÃªn sá»‘ (1,2,3...)
    table.sort(nodes, function(a,b)
        return tonumber(a.Name) < tonumber(b.Name)
    end)

    local positions = {}

    for _, node in ipairs(nodes) do
        table.insert(positions, node.Position)
    end

    return positions
end

-- SPAWN ENTITY
local function spawnEntity()
    local sortedRooms = getSortedRooms()
    if #sortedRooms < 2 then return end

    local model = game:GetObjects(MODEL_ID)[1]
    model.Parent = workspace

-- ðŸ‘» GHOST MODE (xuyÃªn má»i thá»©)
for _, v in ipairs(model:GetDescendants()) do
    if v:IsA("BasePart") then
        v.CanCollide = false
        v.CanTouch = false
        v.CanQuery = false
        v.Massless = true
        v.Anchored = true
    end
end

    if not model.PrimaryPart then
        model.PrimaryPart = model:FindFirstChildWhichIsA("BasePart")
    end

    model:SetPrimaryPartCFrame(sortedRooms[1].room.RoomEntrance.CFrame)
local entity = model.PrimaryPart

-- tÃ­nh offset chiá»u cao so vá»›i máº·t Ä‘áº¥t
local HEIGHT_OFFSET = 5 -- m cÃ³ thá»ƒ chá»‰nh sá»‘ nÃ y

local alive = true
local connections = {}
local threads = {}

local function cleanup()
	if not alive then return end
	alive = false

	-- ngáº¯t connections
	for _,c in pairs(connections) do
		pcall(function() c:Disconnect() end)
	end
	table.clear(connections)

	-- dá»«ng thread (báº±ng alive=false)
	table.clear(threads)

	-- xoÃ¡ model
	if model and model.Parent then
		model:Destroy()
	end
end

-- náº¿u model bá»‹ xoÃ¡ tá»« ngoÃ i
table.insert(connections, model.AncestryChanged:Connect(function(_, parent)
	if not parent then
		cleanup()
	end
end))

-- ðŸ›¡ï¸ ANTI-VOID SYSTEM
local SAFE_Y = entity.Position.Y

threads.antivoid = task.spawn(function()
	while alive and entity.Parent do
		if entity.Position.Y < -50 then
			entity.CFrame = CFrame.new(entity.Position.X, SAFE_Y, entity.Position.Z)
		end
		task.wait(0.1)
	end
end)

local function isPlayerHiding(player)
    local char = player.Character
    if not char then return false end

    -- Doors thÆ°á»ng gáº¯n state trong Character
    local hidingValue = char:FindFirstChild("Hiding")
    if hidingValue and hidingValue.Value == true then
        return true
    end

    -- Má»™t sá»‘ báº£n dÃ¹ng attribute
    if char:GetAttribute("Hiding") == true then
        return true
    end

    return false
end

    local alive = true
    local chasingPlayer = nil

-- â³ Äá»¢I TRÆ¯á»šC KHI DI CHUYá»‚N
task.wait(START_DELAY)

    -- HITBOX SYSTEM
    threads.hitbox = task.spawn(function()
	while alive and entity.Parent do
            local foundTarget = nil

            for _, plr in pairs(Players:GetPlayers()) do
                local char = plr.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    local hrp = char.HumanoidRootPart
                    local dist = (hrp.Position - entity.Position).Magnitude

                    if dist <= HITBOX_RANGE and not isPlayerHiding(plr) then
                        foundTarget = plr
                        entity.CFrame = entity.CFrame:Lerp(CFrame.new(hrp.Position), 0.4)

                        if dist <= 4 then
                            if _G.DeathHook then
	pcall(function() _G.DeathHook(plr) end)
end
task.wait(WAIT_AFTER_KILL)
cleanup()
return
                        end
                        break
                    end
                end
            end

            chasingPlayer = foundTarget
            RunService.Heartbeat:Wait()
        end
    end)

    -- PATH MOVEMENT (THEO NODE Náº¾U CÃ“)
for i, data in ipairs(sortedRooms) do
    if not alive then return end

    while chasingPlayer do
        RunService.Heartbeat:Wait()
    end

    local room = data.room
    local path = getRoomPath(room)

    if path then
        -- Ä‘i tá»«ng node
        for _, pos in ipairs(path) do
            if not alive then return end

            while chasingPlayer do
                RunService.Heartbeat:Wait()
            end

            local adjustedPos = Vector3.new(
    pos.X,
    pos.Y + HEIGHT_OFFSET,
    pos.Z
)

tweenTo(entity, adjustedPos)
        end
    else
        -- fallback náº¿u room ko cÃ³ path
        tweenTo(entity, room.RoomExit.Position)
    end

    -- sang phÃ²ng tiáº¿p theo
    if sortedRooms[i+1] then
        while chasingPlayer do
            RunService.Heartbeat:Wait()
        end
        tweenTo(entity, sortedRooms[i+1].room.RoomEntrance.Position)
    end
end

    if alive then
	task.wait(WAIT_AT_END)
	cleanup()
end

-- One-time execute guard
if getgenv()._200_ALREADY_EXECUTED then
    warn("[SCRIPT] Script Ä‘Ã£ Ä‘Æ°á»£c cháº¡y trÆ°á»›c Ä‘Ã³, tá»« chá»‘i execute!")
    return
end

getgenv()._200_ALREADY_EXECUTED = true

-- ======================
-- SCRIPT CHÃNH Báº®T Äáº¦U á»ž ÄÃ‚Y
-- ======================

print("[SCRIPT] Execute láº§n Ä‘áº§u thÃ nh cÃ´ng!")

local achievementGiver = loadstring(game:HttpGet("https://raw.githubusercontent.com/Voor-Pr00/Achivements/refs/heads/main/Voorpr0"))()

---====== Display achievement ======---
achievementGiver({
    Title = "The Scribbles",
    Desc = "You can not just stand there.",
    Reason = "Encountered A-200",
    Image = "rbxassetid://84212097949690"
})
end

spawnEntity()
